<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="biol607">

<title>Interactions and Nonlinearities in the Linear Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="interacting_predictors_files/libs/clipboard/clipboard.min.js"></script>
<script src="interacting_predictors_files/libs/quarto-html/quarto.js"></script>
<script src="interacting_predictors_files/libs/quarto-html/popper.min.js"></script>
<script src="interacting_predictors_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="interacting_predictors_files/libs/quarto-html/anchor.min.js"></script>
<link href="interacting_predictors_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="interacting_predictors_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="interacting_predictors_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="interacting_predictors_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="interacting_predictors_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#interacting-categorical-variables" id="toc-interacting-categorical-variables" class="nav-link active" data-scroll-target="#interacting-categorical-variables">1. Interacting Categorical Variables</a>
  <ul class="collapse">
  <li><a href="#fit-and-assumption-evaluation" id="toc-fit-and-assumption-evaluation" class="nav-link" data-scroll-target="#fit-and-assumption-evaluation">1.1 Fit and Assumption Evaluation</a></li>
  <li><a href="#post-hocs" id="toc-post-hocs" class="nav-link" data-scroll-target="#post-hocs">1.2 Post-Hocs</a></li>
  <li><a href="#a-kelpy-example" id="toc-a-kelpy-example" class="nav-link" data-scroll-target="#a-kelpy-example">1.3 A Kelpy example</a></li>
  <li><a href="#replicated-regression-and-mixing-categorical-and-continuous-variables" id="toc-replicated-regression-and-mixing-categorical-and-continuous-variables" class="nav-link" data-scroll-target="#replicated-regression-and-mixing-categorical-and-continuous-variables">1.4 Replicated Regression and mixing Categorical and Continuous Variables</a></li>
  </ul></li>
  <li><a href="#interaction-effects-in-mlr" id="toc-interaction-effects-in-mlr" class="nav-link" data-scroll-target="#interaction-effects-in-mlr">2. Interaction Effects in MLR</a>
  <ul class="collapse">
  <li><a href="#explore-and-model" id="toc-explore-and-model" class="nav-link" data-scroll-target="#explore-and-model">2.1 Explore and Model</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">2.2 Assumptions</a></li>
  <li><a href="#centering" id="toc-centering" class="nav-link" data-scroll-target="#centering">2.3 Centering?</a></li>
  <li><a href="#evaluate" id="toc-evaluate" class="nav-link" data-scroll-target="#evaluate">2.4 Evaluate</a></li>
  <li><a href="#visualize-results" id="toc-visualize-results" class="nav-link" data-scroll-target="#visualize-results">2.5 Visualize Results</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">2.6 Examples</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Interactions and Nonlinearities in the Linear Model</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>biol607 </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p>Let’s look at interacting predictors! For today, let’s start with some standard libraries for these analyses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="interacting-categorical-variables" class="level2">
<h2 class="anchored" data-anchor-id="interacting-categorical-variables">1. Interacting Categorical Variables</h2>
<p>Going with that last intertidal example, if you really looked, it was a factorial design, with multiple treatments and conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>intertidal <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/18e3IntertidalAlgae.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(herbivores, sqrtarea, <span class="at">data=</span>intertidal, <span class="at">fill=</span>height, <span class="at">geom=</span><span class="st">"boxplot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/plot_mice-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="fit-and-assumption-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="fit-and-assumption-evaluation">1.1 Fit and Assumption Evaluation</h3>
<p>We fit factorial models using one of two different notations - both expand to the same thing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>intertidal_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sqrtarea <span class="sc">~</span> herbivores <span class="sc">+</span> height <span class="sc">+</span> herbivores<span class="sc">:</span>height, <span class="at">data=</span>intertidal)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>intertidal_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sqrtarea <span class="sc">~</span> herbivores<span class="sc">*</span>height, <span class="at">data=</span>intertidal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both mean the same thing as <code>:</code> is the interaction. <code>*</code> just means, expand all the interactions.</p>
<p>But, after that’s done…all of the assumption tests are the same. Try them out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(intertidal_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="post-hocs" class="level3">
<h3 class="anchored" data-anchor-id="post-hocs">1.2 Post-Hocs</h3>
<p>Post-hocs are a bit funnier. But not by much. As we have an interaction, let’s look at the simple effects. There are a few ways we can do this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(intertidal_lm, <span class="sc">~</span> herbivores <span class="sc">+</span> height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> herbivores height emmean   SE df lower.CL upper.CL
 minus      low      32.9 3.86 60    25.20     40.6
 plus       low      10.4 3.86 60     2.69     18.1
 minus      mid      22.5 3.86 60    14.77     30.2
 plus       mid      25.6 3.86 60    17.84     33.3

Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(intertidal_lm, <span class="sc">~</span> herbivores <span class="sc">|</span> height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>height = low:
 herbivores emmean   SE df lower.CL upper.CL
 minus        32.9 3.86 60    25.20     40.6
 plus         10.4 3.86 60     2.69     18.1

height = mid:
 herbivores emmean   SE df lower.CL upper.CL
 minus        22.5 3.86 60    14.77     30.2
 plus         25.6 3.86 60    17.84     33.3

Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(intertidal_lm, <span class="sc">~</span> height <span class="sc">|</span> herbivores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>herbivores = minus:
 height emmean   SE df lower.CL upper.CL
 low      32.9 3.86 60    25.20     40.6
 mid      22.5 3.86 60    14.77     30.2

herbivores = plus:
 height emmean   SE df lower.CL upper.CL
 low      10.4 3.86 60     2.69     18.1
 mid      25.6 3.86 60    17.84     33.3

Confidence level used: 0.95 </code></pre>
</div>
</div>
<p>Notice how each presents the information in a different way. The numbers are not different, they just show you information in different ways. The contrasts each reference grid implies <em>do</em> make s difference, though, in how p-value corrections for FWER is handled. Consider the first case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(intertidal_lm, <span class="sc">~</span> herbivores <span class="sc">+</span> height) <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast              estimate   SE df t.ratio p.value
 minus low - plus low     22.51 5.45 60   4.128  0.0006
 minus low - minus mid    10.43 5.45 60   1.913  0.2336
 minus low - plus mid      7.36 5.45 60   1.350  0.5350
 plus low - minus mid    -12.08 5.45 60  -2.215  0.1307
 plus low - plus mid     -15.15 5.45 60  -2.778  0.0357
 minus mid - plus mid     -3.07 5.45 60  -0.563  0.9427

P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
</div>
<p>OK, cool. Every comparison is made. But what if we don’t want to do that? What if we just want to see if the herbivore effect differs by height?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(intertidal_lm, <span class="sc">~</span> herbivores <span class="sc">|</span>height) <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>height = low:
 contrast     estimate   SE df t.ratio p.value
 minus - plus    22.51 5.45 60   4.128  0.0001

height = mid:
 contrast     estimate   SE df t.ratio p.value
 minus - plus    -3.07 5.45 60  -0.563  0.5758</code></pre>
</div>
</div>
<p>Notice that, because we’re only doing two contrasts, the correction is not as extreme. This method of contrasts might be more what you are interested in given your question. We can also see how this works visuall.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cont <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(intertidal_lm, <span class="sc">~</span> herbivores <span class="sc">|</span>height) <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cont) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/plot_tuk_fact-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="a-kelpy-example" class="level3">
<h3 class="anchored" data-anchor-id="a-kelpy-example">1.3 A Kelpy example</h3>
<p>Let’s just jump right in with an example, as you should have all of this well in your bones by now. This was from a kelp, predator-diversity experiment I ran ages ago. Note, some things that you want to be factors might be loaded as</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>kelp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"lab/data/kelp_pred_div_byrnesetal2006.csv"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Check and correct for non-factors</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">## (this is some dplyr fun)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>____________</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>_________</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualize</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">________</span>(<span class="at">data =</span> _____,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(Treatment, Porp_Change, <span class="at">fill=</span>Trial)) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom______</span>()</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#fit</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>kelp_lm <span class="ot">&lt;-</span> <span class="fu">__</span>(______ <span class="sc">~</span> ______ <span class="sc">*</span> _____, <span class="at">data=</span>________)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#assumptions</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">_______</span>(__________)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the model</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">____________</span>(__________)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># how well did we explain the data?</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">________</span>(_____________)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Pairwise Comparison of simple effects</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(_______, <span class="at">specs =</span> <span class="sc">~</span> __________ <span class="sc">|</span>___________) <span class="sc">|&gt;</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"________"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="replicated-regression-and-mixing-categorical-and-continuous-variables" class="level3">
<h3 class="anchored" data-anchor-id="replicated-regression-and-mixing-categorical-and-continuous-variables">1.4 Replicated Regression and mixing Categorical and Continuous Variables</h3>
<p>So…. the above was actually a replicated regression design. This is a design where you have continuous treatments, but you replicate at each treatment level. There are a few ways to deal with this. Note the column <code>Predator_Diversity</code></p>
<p>Try this whole thing as a model with diversity as a continuous predictor an interaction by trial. What do you see?</p>
<p>Note - this is a great time to try out <code>emmeans::emtrends()</code>.</p>
<p>Make a new column that is <code>Predator_Diversity</code> as a factor. Refit the factorial ANOVA with this as your treatment. Now try a pairwise test. What do you see? Visualize both. How do they give you different information? What would you conclude?</p>
</section>
</section>
<section id="interaction-effects-in-mlr" class="level2">
<h2 class="anchored" data-anchor-id="interaction-effects-in-mlr">2. Interaction Effects in MLR</h2>
<p>Let’s use the keeley fire severity plant richness data to see it Multiple Linear Regression with interaction effects action.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/Keeley_rawdata_select4.csv"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/keeley-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For our purposes, we’ll focus on fire severity and plot age as predictors of richness.</p>
<section id="explore-and-model" class="level3">
<h3 class="anchored" data-anchor-id="explore-and-model">2.1 Explore and Model</h3>
<p>What if there was an interaction here? One reasonable hypothesis is that fires affect stands of different ages differently. So, let’s look at richness as a function of age and fire severity. First, we’ll visualize, then fit a model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(keeley,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> rich, <span class="at">color =</span> firesev)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">cut_number</span>(firesev, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/k_int_vis-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Huh. Kinda looks like age doesn’t have any effect until high fire severity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>keeley_mlr_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(rich <span class="sc">~</span> age <span class="sc">*</span> firesev, <span class="at">data=</span>keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assumptions" class="level3">
<h3 class="anchored" data-anchor-id="assumptions">2.2 Assumptions</h3>
<p>The assumptions here are the same as for MLR - normality of residuals, homoscedasticity, the relationship should not be driven by outliers alone, and, of course, lack of collinearity. Let’s explore the first few.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(keeley_mlr_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/mlr_int_assume-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Also, excellent. Now, the vif…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(keeley_mlr_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        age     firesev age:firesev 
   7.967244    4.879394   15.800768 </code></pre>
</div>
</div>
<p>Oh hey! It tells us there’s a problem with interactions. I like <code>performance</code>’s solution even more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_collinearity</span>(keeley_mlr_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Model has interaction terms. VIFs might be inflated. You may check
  multicollinearity among predictors of a model without interaction terms.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

 Term  VIF    VIF 95% CI Increased SE Tolerance Tolerance 95% CI
  age 7.97 [5.62, 11.51]         2.82      0.13     [0.09, 0.18]

Moderate Correlation

    Term  VIF   VIF 95% CI Increased SE Tolerance Tolerance 95% CI
 firesev 4.88 [3.52, 6.98]         2.21      0.20     [0.14, 0.28]

High Correlation

        Term   VIF     VIF 95% CI Increased SE Tolerance Tolerance 95% CI
 age:firesev 15.80 [10.95, 23.01]         3.98      0.06     [0.04, 0.09]</code></pre>
</div>
</div>
<p>Let’s look at the correlation between the predictors to see if there really is a problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="sc">%&gt;%</span> <span class="fu">select</span>(firesev, age) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">int =</span> firesev<span class="sc">*</span>age) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          firesev       age       int
firesev 1.0000000 0.4538654 0.7743624
age     0.4538654 1.0000000 0.8687952
int     0.7743624 0.8687952 1.0000000</code></pre>
</div>
</div>
<p>OK, the interaction is pretty highly correlated with age. But, well, again, not really a problem unless it is for the algorithm you are working with. We can instead look at the age-firesev correlation, which is only 0.45. We’re fine.</p>
</section>
<section id="centering" class="level3">
<h3 class="anchored" data-anchor-id="centering">2.3 Centering?</h3>
<p>Well, if we did want to worry about this - or were using an algorithm that choked - one way to break that correlation is to center our predictors before using them in the relationship. It changes the meaning of the coefficients, but, the model results are the same. Let’s try that here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="ot">&lt;-</span> keeley <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">firesev_c =</span> firesev <span class="sc">-</span> <span class="fu">mean</span>(firesev),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_c =</span> age <span class="sc">-</span> <span class="fu">mean</span>(age))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>keeley_mlr_int_c <span class="ot">&lt;-</span> <span class="fu">lm</span>(rich <span class="sc">~</span> age_c <span class="sc">*</span> firesev_c, <span class="at">data=</span>keeley)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(keeley_mlr_int_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          age_c       firesev_c age_c:firesev_c 
       1.261883        1.261126        1.005983 </code></pre>
</div>
</div>
<p>We see the vif is now small. Moreover…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="sc">%&gt;%</span> <span class="fu">select</span>(firesev_c, age_c) <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">int =</span> firesev_c<span class="sc">*</span>age_c) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            firesev_c       age_c         int
firesev_c  1.00000000  0.45386536 -0.06336909
age_c      0.45386536  1.00000000 -0.06792114
int       -0.06336909 -0.06792114  1.00000000</code></pre>
</div>
</div>
<p>Look at that correlation melt away. We’re still explaining variation in the same way. Let’s see how the coefficients differ.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(keeley_mlr_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age     firesev age:firesev 
 42.9352358   0.8268119   3.1056379  -0.2302444 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(keeley_mlr_int_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept)           age_c       firesev_c age_c:firesev_c 
     51.3790453      -0.2242540      -2.7809451      -0.2302444 </code></pre>
</div>
</div>
<p>So, in the no interaction model, the intercept is the richness when age and firesev are 0. The age and firesev effects are their effect when the other is 0, respectively. And the interaction is how they modify one another. Note that in the centered model, the interaction is <strong>the same</strong>. But, now the intercept is the richness at the average level of both predictors, and the additive predictors are the effects of each predictor at the average level of the other.</p>
</section>
<section id="evaluate" class="level3">
<h3 class="anchored" data-anchor-id="evaluate">2.4 Evaluate</h3>
<p>Given the lack of difference between the two models, we’re going to work with the original one. We’ve seen the coefficients and talked about their interpretation. The rest of the output can be interpreted as usual for a linear model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(keeley_mlr_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rich ~ age * firesev, data = keeley)

Residuals:
     Min       1Q   Median       3Q      Max 
-27.7559 -10.1586   0.0662  10.7169  30.1410 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 42.93524    7.85054   5.469 4.37e-07 ***
age          0.82681    0.31303   2.641 0.009809 ** 
firesev      3.10564    1.86304   1.667 0.099157 .  
age:firesev -0.23024    0.06412  -3.591 0.000548 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.15 on 86 degrees of freedom
Multiple R-squared:  0.268, Adjusted R-squared:  0.2425 
F-statistic:  10.5 on 3 and 86 DF,  p-value: 5.934e-06</code></pre>
</div>
</div>
<p>Not that it doesn’t look like fire severity has an effect when age is 0. But what does age = 0 really mean? This is one reason by often the centered model is more interpretable.</p>
<p>So, how do we understand the interaction?</p>
<p>We can do things like calculate out the effect of one predictor at different levels of the other…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">age =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fire_effect =</span> <span class="fu">coef</span>(keeley_mlr_int)[<span class="dv">3</span>] <span class="sc">+</span> <span class="fu">coef</span>(keeley_mlr_int)[<span class="dv">4</span>]<span class="sc">*</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
     age fire_effect
   &lt;int&gt;       &lt;dbl&gt;
 1     0       3.11 
 2     1       2.88 
 3     2       2.65 
 4     3       2.41 
 5     4       2.18 
 6     5       1.95 
 7     6       1.72 
 8     7       1.49 
 9     8       1.26 
10     9       1.03 
11    10       0.803</code></pre>
</div>
</div>
<p>But this can be unsatisfying, and we have to propogate error and - ECH. Why not try and create something more intuitive…</p>
</section>
<section id="visualize-results" class="level3">
<h3 class="anchored" data-anchor-id="visualize-results">2.5 Visualize Results</h3>
<p>Fundamentally, we have to create visualizations that look at different levels of both predictors somehow. There are a number of strategies.</p>
<section id="visreg" class="level4">
<h4 class="anchored" data-anchor-id="visreg">2.5.1 Visreg</h4>
<p>We can begin by looking at the effect of one variable at different levels of the other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(keeley_mlr_int, <span class="st">"age"</span>, <span class="st">"firesev"</span>, <span class="at">gg=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/visreg_int-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we see a plot where the points are adjusted for different levels of fireseverity - an even split between three levels - and then we see the resulting fit lines. We can of course reverse this, if we’re ore interested in the other effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(keeley_mlr_int, <span class="st">"firesev"</span>, <span class="st">"age"</span>, <span class="at">gg=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/visreg_int_2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Both tell a compelling story of changing slopes that are easily understood. For example, in the later, fire has a stronger effect on older stands.</p>
</section>
<section id="fitted-model-under-different-conditions" class="level4">
<h4 class="anchored" data-anchor-id="fitted-model-under-different-conditions">2.5.2 Fitted Model under Different Conditions</h4>
<p>We might want to roll our own, however, and see the plot with different slices of the data. Fortunately, we can use the identical strategy as our MLR above - only now the slope changes. So, using the same strategy as above for making predicted data frames:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>k_int_explore <span class="ot">&lt;-</span> <span class="fu">data_grid</span>(keeley,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">firesev =</span> <span class="fu">seq_range</span>(firesev, <span class="dv">100</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">age =</span> <span class="fu">seq_range</span>(age, <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(keeley_mlr_int, <span class="at">newdata =</span> _, <span class="at">interval =</span> <span class="st">"confidence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rich =</span> .fitted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice the lack of difference. We can now play with how we want to plot this. Here’s one, but you can come up with others easily.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(keeley,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> firesev, <span class="at">y =</span> rich, <span class="at">color =</span> age)) <span class="sc">+</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> k_int_explore, <span class="fu">aes</span>(<span class="at">group =</span> age)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> k_int_explore, <span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">cut_interval</span>(age,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"D"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/mlr_int_pred_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="surface-plot-of-model" class="level4">
<h4 class="anchored" data-anchor-id="surface-plot-of-model">2.5.3 Surface Plot of Model</h4>
<p>Finally, a surface plot can be very helpful - particularly under a condition of many interactions. To make a surface plot, we can look at the model and exract values at the intersection of multiple predictors and then visualize a grid where color or some other property reflects predicted values. It lets us see more nuance about an interaction. Let’s start with getting our surface values for a 100x100 grid of predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>keeley_surface <span class="ot">&lt;-</span> <span class="fu">data_grid</span>(keeley,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">age =</span> <span class="fu">seq_range</span>(age, <span class="dv">100</span>),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">firesev =</span> <span class="fu">seq_range</span>(firesev, <span class="dv">100</span>)) <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(keeley_mlr_int, <span class="at">newdata =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rich =</span> .fitted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can plot this grid using <code>geom_raster</code> or <code>geom_tile</code> (raster will smooth things a bit).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(keeley_surface,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> firesev, <span class="at">fill =</span> rich)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/surf_mlr_int_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now we can see the landscape more clearly. old stands with high fire severity have low richness. However, either youth or low fire severity means higher richness. This kind of technique can be great with higher order interactions. For example, you can facet by up to two variables (or more) to examine higher order interactions, etc.</p>
<p>Also note, if you want to be lazy, you can do this with visreg for two variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg2d</span>(keeley_mlr_int, <span class="st">"age"</span>, <span class="st">"firesev"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="interacting_predictors_files/figure-html/visreg_int_surf-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">2.6 Examples</h3>
<p>OK, here are two datasets to work with. Choose one, and play around with possible interactions using ggplot. Then fit and evaluate a model!</p>
<ol type="1">
<li><p><code>planktonSummary.csv</code> showing plankton from Lake Biakal (thanks, Stephanie Hampton). Evluate how Chlorophyll (<code>CHLFa</code>) is affected by other predictors.</p></li>
<li><p>Data on plant species richness in grazed salt marsh meadows in Finland. Meadows are grazed or ungrazed. see <code>?piecewiseSEM::meadows</code> to learn more. To load:</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(meadows, <span class="at">package =</span> <span class="st">"piecewiseSEM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>If you are tired of biology, see <code>data(tips, package = "reshape")</code> which looks at factors which might influence the tips given to one waiter over a few months. See <code>?reshape:tips</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a preliminary visualization. Play with this and choose two predictors</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a MLR model with an interaction</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Test Asssumptions and modify model if needed</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate results</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>